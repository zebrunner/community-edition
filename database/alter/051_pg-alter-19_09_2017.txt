set schema 'zafira';

DROP TABLE IF EXISTS USER_PREFERENCES;
CREATE TABLE IF NOT EXISTS USER_PREFERENCES (
    ID SERIAL,
    NAME VARCHAR(255) NOT NULL,
    VALUE VARCHAR(255) NOT NULL ,
    USER_ID INT,
    MODIFIED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (ID),
    CONSTRAINT user_preferences_users_id_fk
      FOREIGN KEY (USER_ID)
      REFERENCES USERS (ID)
      ON DELETE CASCADE
      ON UPDATE NO ACTION);
   CREATE INDEX user_preferences_users_id_fk_idx ON USER_PREFERENCES (USER_ID);
   CREATE UNIQUE INDEX NAME_USER_ID_UNIQUE ON USER_PREFERENCES (NAME, USER_ID);
   CREATE TRIGGER update_timestamp_user_preferences BEFORE INSERT OR UPDATE ON USER_PREFERENCES FOR EACH ROW EXECUTE PROCEDURE update_timestamp();