SET SCHEMA 'zafira';

select check_version(110);

DO $$
DECLARE PERMISSION_ID PERMISSIONS.id%TYPE;
DECLARE GROUP_ID GROUPS.id%TYPE;

BEGIN

	UPDATE PERMISSIONS SET BLOCK = 'TEST_RUN_VIEWS' WHERE NAME = 'MODIFY_TEST_RUN_VIEWS';
	INSERT INTO PERMISSIONS (NAME, BLOCK) VALUES ('VIEW_TEST_RUN_VIEWS', 'TEST_RUN_VIEWS') RETURNING id INTO PERMISSION_ID;

	SELECT ID INTO GROUP_ID FROM GROUPS WHERE NAME = 'Super admins';
  	INSERT INTO GROUP_PERMISSIONS (GROUP_ID, PERMISSION_ID) VALUES (GROUP_ID, PERMISSION_ID);

	SELECT ID INTO GROUP_ID FROM GROUPS WHERE NAME = 'Admins';
  	INSERT INTO GROUP_PERMISSIONS (GROUP_ID, PERMISSION_ID) VALUES (GROUP_ID, PERMISSION_ID);

	SELECT ID INTO GROUP_ID FROM GROUPS WHERE NAME = 'Super users';
  	INSERT INTO GROUP_PERMISSIONS (GROUP_ID, PERMISSION_ID) VALUES (GROUP_ID, PERMISSION_ID);

END$$;

select add_version(110);
