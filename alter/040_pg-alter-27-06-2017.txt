SET SCHEMA 'zafira';

DROP TABLE IF EXISTS TEST_ARTIFACTS;
CREATE TABLE IF NOT EXISTS TEST_ARTIFACTS (
  ID SERIAL,
  NAME VARCHAR(255) NOT NULL,
  LINK TEXT NOT NULL,
  EXPIRES_AT TIMESTAMP NULL,
  TEST_ID INT NOT NULL,
  MODIFIED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (ID),
  CONSTRAINT fk_TEST_ARTIFACTS_TESTS1
    FOREIGN KEY (TEST_ID)
    REFERENCES TESTS (ID)
    ON DELETE CASCADE
    ON UPDATE NO ACTION);
CREATE INDEX fk_TEST_ARTIFACTS_TESTS1_idx ON TEST_ARTIFACTS (TEST_ID);
CREATE TRIGGER update_timestamp_test_artifacts BEFORE INSERT OR UPDATE ON TEST_ARTIFACTS FOR EACH ROW EXECUTE PROCEDURE update_timestamp();
