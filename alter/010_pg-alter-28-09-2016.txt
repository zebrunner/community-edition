SET SCHEMA 'zafira';

CREATE TRIGGER update_timestamp_dashboards BEFORE INSERT OR UPDATE ON DASHBOARDS FOR EACH ROW EXECUTE PROCEDURE update_timestamp();  

  
DROP TABLE IF EXISTS SETTINGS;
CREATE TABLE IF NOT EXISTS SETTINGS (
  ID SERIAL,
  NAME VARCHAR(255) NOT NULL,
  VALUE VARCHAR(255) NULL,
  MODIFIED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (ID));
CREATE UNIQUE INDEX SETTING_UNIQUE ON SETTINGS (NAME);
CREATE TRIGGER update_timestamp_settings BEFORE INSERT OR UPDATE ON SETTINGS FOR EACH ROW EXECUTE PROCEDURE update_timestamp();


DROP TABLE IF EXISTS DEVICES;
CREATE TABLE IF NOT EXISTS DEVICES (
  ID SERIAL,
  MODEL VARCHAR(255) NOT NULL,
  SERIAL VARCHAR(255) NOT NULL,
  ENABLED BOOLEAN NOT NULL DEFAULT FALSE,
  LAST_STATUS BOOLEAN NOT NULL DEFAULT FALSE,
  DISCONNECTS INT NOT NULL DEFAULT 0,
  MODIFIED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (ID)); 
CREATE UNIQUE INDEX SERIAL_UNIQUE ON DEVICES (SERIAL);
CREATE TRIGGER update_timestamp_devices BEFORE INSERT OR UPDATE ON DEVICES FOR EACH ROW EXECUTE PROCEDURE update_timestamp();

INSERT INTO SETTINGS (NAME, VALUE) VALUES ('STF_NOTIFICATION_RECIPIENTS', '');