SET SCHEMA 'zafira';

select check_version(109);

ALTER TABLE WIDGETS ADD COLUMN DESCRIPTION VARCHAR(255) NULL;
ALTER TABLE WIDGETS ADD COLUMN PARAMS_CONFIG TEXT NULL;
ALTER TABLE WIDGETS ADD COLUMN LEGEND_CONFIG TEXT NULL;
ALTER TABLE WIDGETS ADD COLUMN WIDGET_TEMPLATE_ID INT NULL;

ALTER TABLE WIDGETS
   ADD CONSTRAINT fk_WIDGETS_WIDGET_TEMPLATES1
    FOREIGN KEY (WIDGET_TEMPLATE_ID)
    REFERENCES management.WIDGET_TEMPLATES (ID)
    ON DELETE CASCADE
    ON UPDATE NO ACTION;

ALTER TABLE WIDGETS ALTER COLUMN TYPE DROP NOT NULL;
ALTER TABLE WIDGETS ALTER COLUMN TYPE DROP DEFAULT;
ALTER TABLE WIDGETS ALTER COLUMN SQL DROP NOT NULL;
ALTER TABLE WIDGETS ALTER COLUMN MODEL DROP NOT NULL;
CREATE UNIQUE INDEX WIDGETS_TITLE_WIDGET_TEMPLATE_ID_UINDEX ON WIDGETS (TITLE, WIDGET_TEMPLATE_ID);
DROP INDEX WIDGETS_TITLE_TYPE_UINDEX;

select add_version(109);
