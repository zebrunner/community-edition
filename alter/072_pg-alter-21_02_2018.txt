SET SCHEMA 'zafira';

DROP TABLE IF EXISTS MONITOR_STATUSES;
CREATE TABLE IF NOT EXISTS MONITOR_STATUSES (
  ID SERIAL,
  MONITOR_ID INT NOT NULL,
  SUCCESS BOOLEAN NOT NULL DEFAULT FALSE,
  MODIFIED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (ID),
  CONSTRAINT fk_MONITOR_STATUSES_MONITORS1
  FOREIGN KEY (MONITOR_ID)
  REFERENCES MONITORS (ID)
  ON DELETE CASCADE
  ON UPDATE NO ACTION);
CREATE INDEX fk_MONITOR_STATUSES_MONITORS1_idx ON MONITOR_STATUSES (MONITOR_ID);
CREATE TRIGGER update_timestamp_monitor_statuses BEFORE INSERT OR UPDATE ON MONITOR_STATUSES FOR EACH ROW EXECUTE PROCEDURE update_timestamp();